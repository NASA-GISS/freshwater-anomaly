#+NAME: Combining observational and ISMIP freshwater forcing

* Table of contents                               :toc_2:noexport:
- [[#introduction][Introduction]]
- [[#data][Data]]
  - [[#greenland-observations][Greenland observations]]
  - [[#antarctic-observations][Antarctic observations]]
  - [[#greenland-ismip][Greenland ISMIP]]
  - [[#merge-obs--ismip][Merge obs & ismip]]
- [[#questions][Questions]]

* Introduction

Append ISMIP6 SLR estimates onto observationally constrained historical mass loss

* Data

** Greenland observations

+ From [[citet:mankoff_2021][Mankoff (2021)]]
+ Years with mass gain subtracted from following years so that all mass change is <= 0.
+ =hi= and =lo= years are +- published uncertainty from [[citet:mankoff_2021][Mankoff (2021)]]

*** Load Greenland obs

#+BEGIN_SRC jupyter-python
import pandas as pd
obs = pd.read_csv('./out/mass_change_no_gain_greenland.csv',
                 index_col=0,
                 parse_dates=True,
                 comment='#',
                 delim_whitespace=True,
                 names=['Gt/yr'])
obs.index.name='Date'
#+END_SRC

#+RESULTS:


*** Greenland obs table

#+BEGIN_SRC jupyter-python
obs
#+END_SRC

#+RESULTS:
| Date                | Gt/yr |
|---------------------+-------|
| 1990-01-01 00:00:00 | 137.6 |
| 1991-01-01 00:00:00 |  76.7 |
| 1992-01-01 00:00:00 |     0 |
| 1993-01-01 00:00:00 |   3.6 |
| 1994-01-01 00:00:00 | 113.8 |
| 1995-01-01 00:00:00 | 211.9 |
| 1996-01-01 00:00:00 |     0 |
| 1997-01-01 00:00:00 |     0 |
| 1998-01-01 00:00:00 |   102 |
| 1999-01-01 00:00:00 |    47 |
| 2000-01-01 00:00:00 |  77.1 |
| 2001-01-01 00:00:00 |  26.1 |
| 2002-01-01 00:00:00 | 142.5 |
| 2003-01-01 00:00:00 | 167.2 |
| 2004-01-01 00:00:00 | 165.8 |
| 2005-01-01 00:00:00 | 168.4 |
| 2006-01-01 00:00:00 | 239.8 |
| 2007-01-01 00:00:00 | 257.3 |
| 2008-01-01 00:00:00 | 201.2 |
| 2009-01-01 00:00:00 |   243 |
| 2010-01-01 00:00:00 | 376.8 |
| 2011-01-01 00:00:00 | 336.2 |
| 2012-01-01 00:00:00 | 429.3 |
| 2013-01-01 00:00:00 | 107.9 |
| 2014-01-01 00:00:00 | 184.6 |
| 2015-01-01 00:00:00 | 213.9 |
| 2016-01-01 00:00:00 |   256 |
| 2017-01-01 00:00:00 | 102.6 |
| 2018-01-01 00:00:00 |  75.8 |
| 2019-01-01 00:00:00 |   426 |


*** Greenland obs plot
#+BEGIN_SRC jupyter-python
_ = obs.plot(drawstyle='steps')
#+END_SRC

#+RESULTS:
[[file:./figs_tmp/49456009d9f07ae08928903b21a69e5a2a16c6a6.png]]

** Antarctic observations

+ From [[citet:slater_2021][Slater (2021)]]

*** Uncertainty

From [[citet:slater_2021][Slater (2021)]] Table 1

| Component          | Uncertainty [Gt yr^{-1}] |
|--------------------+--------------------------|
| Ice shelf calving  |                       36 |
| Ice shelf thinning |                       39 |
| Antarctic land ice |                       24 |
|--------------------+--------------------------|
| mean               |                       33 |
| sum                |                       99 |
#+TBLFM: @5$2=vmean(@2..@-1)::@6$2=vsum(@2..@4)

+ Assume these are 1 \sigma uncertainty
+ lo/mid/hi estimates can use mean (33), max (39) or sum (99)

**** If fields are random

#+BEGIN_SRC jupyter-python
from uncertainties import unumpy
import numpy as np
np.sum(unumpy.uarray([1,1,1], [36,39,24]))
#+END_SRC

#+RESULTS:
: 3.0+/-58.249463516842795

** Greenland ISMIP

*** Load ISMIP SSP 245

#+NAME: load_ismip
#+BEGIN_SRC jupyter-python
import xarray as xr
ds = xr.open_dataset('./ISMIP6/emulandiceAIS_GIS_ssp245_globalsl_GT.nc')
ismip = ds['GIS_sea_level_change']\
    .to_dataframe()\
    .unstack().T

ismip.index = [pd.to_datetime(_[1], format='%Y') for _ in ismip.index]
ismip.index.name = 'Date'
#+END_SRC

#+RESULTS: load_ismip

*** Table

#+BEGIN_SRC jupyter-python
ismip
#+END_SRC

#+RESULTS:
| Date                |    50 |    17 |    83 |
|---------------------+-------+-------+-------|
| 2020-01-01 00:00:00 |  1800 |  1440 |  2520 |
| 2030-01-01 00:00:00 |  3960 |  2880 |  5400 |
| 2040-01-01 00:00:00 |  6480 |  4680 |  9000 |
| 2050-01-01 00:00:00 | 10080 |  6840 | 13320 |
| 2060-01-01 00:00:00 | 12960 |  8640 | 18000 |
| 2070-01-01 00:00:00 | 16920 | 10800 | 23760 |
| 2080-01-01 00:00:00 | 20880 | 12240 | 30600 |
| 2090-01-01 00:00:00 | 25200 | 13320 | 37800 |
| 2100-01-01 00:00:00 | 27720 | 12600 | 45720 |

*** ISMIP annual contribution

#+BEGIN_SRC jupyter-python
ismip_ann = ismip.resample('1Y').mean().interpolate().diff()
_ = ismip_ann.plot(drawstyle='steps', title='Greenland freshwater [Gt yr$^{-1}$]')
#+END_SRC

#+RESULTS:
[[file:./figs_tmp/7e86524a86633b5bf09d26614c2fc7975f01d334.png]]

** Merge obs & ismip

#+BEGIN_SRC jupyter-python
# pd.concat((obs, ismip_ann)).interpolate()
obs_17_50_83 = pd.concat([obs]*3, axis='columns', ignore_index=True)
obs_17_50_83 = obs_17_50_83.rename(columns={0:17, 1:50, 2:83})
df = pd.concat((obs_17_50_83, ismip_ann)).interpolate()
df.head(50).tail(30)
#+END_SRC

#+RESULTS:
| Date                |    17 |    50 |    83 |
|---------------------+-------+-------+-------|
| 2010-01-01 00:00:00 | 376.8 | 376.8 | 376.8 |
| 2011-01-01 00:00:00 | 336.2 | 336.2 | 336.2 |
| 2012-01-01 00:00:00 | 429.3 | 429.3 | 429.3 |
| 2013-01-01 00:00:00 | 107.9 | 107.9 | 107.9 |
| 2014-01-01 00:00:00 | 184.6 | 184.6 | 184.6 |
| 2015-01-01 00:00:00 | 213.9 | 213.9 | 213.9 |
| 2016-01-01 00:00:00 |   256 |   256 |   256 |
| 2017-01-01 00:00:00 | 102.6 | 102.6 | 102.6 |
| 2018-01-01 00:00:00 |  75.8 |  75.8 |  75.8 |
| 2019-01-01 00:00:00 |   426 |   426 |   426 |
| 2020-12-31 00:00:00 |   285 |   321 |   357 |
| 2021-12-31 00:00:00 |   144 |   216 |   288 |
| 2022-12-31 00:00:00 |   144 |   216 |   288 |
| 2023-12-31 00:00:00 |   144 |   216 |   288 |
| 2024-12-31 00:00:00 |   144 |   216 |   288 |
| 2025-12-31 00:00:00 |   144 |   216 |   288 |
| 2026-12-31 00:00:00 |   144 |   216 |   288 |
| 2027-12-31 00:00:00 |   144 |   216 |   288 |
| 2028-12-31 00:00:00 |   144 |   216 |   288 |
| 2029-12-31 00:00:00 |   144 |   216 |   288 |
| 2030-12-31 00:00:00 |   144 |   216 |   288 |
| 2031-12-31 00:00:00 |   180 |   252 |   360 |
| 2032-12-31 00:00:00 |   180 |   252 |   360 |
| 2033-12-31 00:00:00 |   180 |   252 |   360 |
| 2034-12-31 00:00:00 |   180 |   252 |   360 |
| 2035-12-31 00:00:00 |   180 |   252 |   360 |
| 2036-12-31 00:00:00 |   180 |   252 |   360 |
| 2037-12-31 00:00:00 |   180 |   252 |   360 |
| 2038-12-31 00:00:00 |   180 |   252 |   360 |
| 2039-12-31 00:00:00 |   180 |   252 |   360 |

*** Plot

#+BEGIN_SRC jupyter-python
import matplotlib.pyplot as plt
fig = plt.figure()
ax = fig.add_subplot(111)

obs_17_50_83[50].plot(drawstyle='steps', ax=ax, y='Gt/yr', label='Observations', color='k')
obs_17_50_83[50].resample('10Y').mean().plot(drawstyle='steps', ax=ax, y='Gt/yr', label='Obs: Decadal average', color='k', alpha=0.5, linewidth=3)
df.loc['2019':].plot(drawstyle='steps', ax=ax)
plt.legend()
#+END_SRC

#+RESULTS:
:RESULTS:
: <matplotlib.legend.Legend at 0x7f18c2a88c40>
[[file:./figs_tmp/c6155a076f2654b87971d1c40a04fc2a814625c1.png]]
:END:

* Questions

+ ISMIP
  + Have 245 and 585
  + For each, ~quantiles = [17, 50, 83]~
+ Greenland
  + Have obs and obs+err (=mass_change_no_gain_greenland_hi.csv=)
    + [ ] How to handle Greenland observational uncertainty?
+ Antarctica
  + Have obs, and various fuzzy definitions of uncertainty
    + [ ] How to handle Greenland observational uncertainty?
