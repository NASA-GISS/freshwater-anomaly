* Table of contents                               :toc_2:noexport:
- [[#introduction][Introduction]]
- [[#slater-et-al-fig-4][Slater /et al./ Fig. 4]]
- [[#greenland][Greenland]]
  - [[#fetch-historical-observations][Fetch historical observations]]
  - [[#process-to-modele-format][Process to ModelE format]]
- [[#antarctica][Antarctica]]

* Introduction

This workbook computes freshwater anomaly from Greenland and Antarctica for the NASA GISS ModelE.

+ Anomaly is defined as mass loss since 1990
+ Temporal resolution is annual
+ Spatially, ModelE distributes a single value according to a 'distribution field' - a floating point mask that sums to 1.

* Slater /et al./ Fig. 4

+ See https://doi.org/10.5194/tc-15-233-2021
+ Data shared via email (pers. comm.)

#+BEGIN_SRC jupyter-python
import pandas as pd

kw = {'parse_dates':True, 'index_col':0}
SH_ice = pd.read_csv('./input/SH_seaice_cumul_1994_2017_annual.csv', names=['Antarctic Sea Ice'], **kw)
NH_ice = pd.read_csv('./input/NH_seaice_cumul_1994_2017_annual.csv', names=['Arctic Sea Ice'], **kw)
shelf_calving = pd.read_csv('./input/iceshelves_calving_cumul_1994_2017_annual.csv', names=['Ice Shelf Calving'], **kw)
shelf_thinning = pd.read_csv('./input/iceshelves_thinning_cumul_1994_2017_annual.csv', names=['Ice Shelf Thinning'], **kw)
AQ = pd.read_csv('./input/AIS_cumul_1994_2017_annual.csv', names=['Antarctica'], **kw)
GL = pd.read_csv('./input/GrIS_cumul_1994_2017_annual.csv', names=['Greenland'], **kw)
glacier = pd.read_csv('./input/Glacier_cumul_1994_2017_annual.csv', names=['Glaciers'], **kw)

kw = {'left_index':True, 'right_index':True, 'how':'outer'}
df = SH_ice.merge(NH_ice, **kw)\
           .merge(shelf_calving, **kw)\
           .merge(shelf_thinning, **kw)\
           .merge(AQ, **kw)\
           .merge(GL, **kw)\
           .merge(glacier, **kw)
df.index.name = 'Date'

# df.plot.area() # NO
# Split positive and negative and plot separately but visually combined
# https://stackoverflow.com/questions/52872938/stacked-area-plot-in-python-with-positive-and-negative-values
import matplotlib.pyplot as plt
fig, ax = plt.subplots()
cm = 'GnBu'
df_neg, df_pos = df.clip(upper=0), df.clip(lower=0)
df_pos.plot.area(ax=ax, stacked=True, linewidth=0., cmap=cm)
ax.set_prop_cycle(None)
df_neg.plot.area(ax=ax, stacked=True, linewidth=0., legend=False, cmap=cm)
ax.set_ylim([df_neg.sum(axis=1).min(), df_pos.sum(axis=1).max()])
plt.hlines(0, 0, 1E3, color='k', linewidth=1, alpha=0.33, linestyles='dashed')

plt.savefig('./fig/slater_2021_fig4.png', dpi=150)
#+END_SRC

#+RESULTS:
:RESULTS:
: /home/kdm/local/miniconda3/envs/ds/lib/python3.8/site-packages/pandas/plotting/_matplotlib/core.py:1437: UserWarning: Attempting to set identical bottom == top == 0.0 results in singular transformations; automatically expanding.
:   ax.set_ylim(None, 0)
[[file:./.ob-jupyter/e800dd8d7ee08532ba0a7da1d4803d95e13cb771.png]]
:END:


* Greenland

Greenland mass loss comes from historical observations and future simulations.

Historical:
+ Paper: Mankoff /et al./ 2021; https://doi.org/10.5194/essd-13-5001-2021
+ Data: https://doi.org/10.22008/FK2/OHI23Z v439

** Fetch historical observations

#+BEGIN_SRC bash
mkdir input
wget -nc  https://dataverse.geus.dk/api/access/datafile/:persistentId?persistentId=doi:10.22008/FK2/OHI23Z/NBMCEK -O ./input/mankoff_2021.csv
#+END_SRC

#+RESULTS:

** Process to ModelE format

#+BEGIN_SRC jupyter-python
import pandas as pd
df = pd.read_csv('./input/mankoff_2021.csv',
                 parse_dates = True,
                 index_col = 0)

df = df.loc['1990-01-01':'2020-12-31']
df = df.resample('YS').sum()
df = df['MB']
df
#+END_SRC

#+RESULTS:
#+begin_example
time
1990-01-01   -138.730546
1991-01-01    -78.035251
1992-01-01     86.510696
1993-01-01    -91.168942
1994-01-01   -113.813365
1995-01-01   -212.258811
1996-01-01    131.861276
1997-01-01      7.228484
1998-01-01   -242.034055
1999-01-01    -47.090412
2000-01-01    -77.221410
2001-01-01    -26.031650
2002-01-01   -142.376845
2003-01-01   -167.267936
2004-01-01   -166.197877
2005-01-01   -168.408093
2006-01-01   -239.836278
2007-01-01   -257.300333
2008-01-01   -199.784137
2009-01-01   -241.123712
2010-01-01   -374.126750
2011-01-01   -330.186274
2012-01-01   -425.403462
2013-01-01   -100.150906
2014-01-01   -182.195958
2015-01-01   -213.177325
2016-01-01   -255.469501
2017-01-01   -101.391264
2018-01-01    -72.974441
2019-01-01   -411.930477
2020-01-01   -173.929899
Freq: AS-JAN, Name: MB, dtype: float64
#+end_example

* Antarctica
